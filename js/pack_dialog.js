(function($,p,q){var r={'zh-cn':{OK:'确定',CANCEL:'取消',CLOSE:'关闭',TIPS:'提示',LOADING:'加载中...',ERROR:'呃，没有成功，请重试'},'en-us':{OK:'OK',CANCEL:'Canel',CLOSE:'Close',TIPS:'Tips',LOADING:'loading...',ERROR:'Operation failed, please try again.'}},getLocale=function(a){var b=navigator,locale=(a||b.language||b.userLanguage||b.browserLanguage||navigator.systemLanguage).toLowerCase();return r[locale]||r['zh-cn']},LANG=getLocale(),CONFIG={title:LANG.TIPS,message:LANG.LOADING,errorMessage:LANG.ERROR,overlay:true,shadow:true,iframe:true,minWidth:200,minHeight:90,dialogClass:''},CLASS={overlay:'dialog-overlay',shadow:'dialog-shadow',box:'dialog-box',dialog_ok:'dialog-ok',dialog_error:'dialog-error',dialog_confirm:'dialog-confirm',title:'dialog-title',close:'dialog-close',content:'dialog-content',content_inner:'dialog-content-inner',footer:'dialog-footer',widget:'dialog-widget',buttons:'dialog-buttons',button:'dialog-button',button_hover:'dialog-button-over',button_focus:'dialog-button-active',tips:'dialog-tips'},GUID=0,PREFIX='dialog_',ZINDEX=1000,OPACITY=0.8,SHADOW_OPACITY=0.2,UNIT_PX='px',SHADOW_PADDING=10,BOX_BORDER_WIDTH=1,doc=document,doe=doc.documentElement,max=Math.max,min=Math.min;!$.fn.bgiframe&&($.fn.bgiframe=($.browser.msie&&/msie 6\.0/i.test(navigator.userAgent)?function(s){s=$.extend({top:'auto',left:'auto',width:'auto',height:'auto',opacity:true,src:'about:blank'},s);var a='<iframe class="bgiframe"frameborder="0"tabindex="-1"src="'+s.src+'"'+'style="display:block;position:absolute;z-index:-1;'+(s.opacity!==false?'filter:Alpha(Opacity=\'0\');':'')+'top:'+(s.top=='auto'?'expression(((parseInt(this.parentNode.currentStyle.borderTopWidth)||0)*-1)+\'px\')':prop(s.top))+';'+'left:'+(s.left=='auto'?'expression(((parseInt(this.parentNode.currentStyle.borderLeftWidth)||0)*-1)+\'px\')':prop(s.left))+';'+'width:'+(s.width=='auto'?'expression(this.parentNode.offsetWidth+\'px\')':prop(s.width))+';'+'height:'+(s.height=='auto'?'expression(this.parentNode.offsetHeight+\'px\')':prop(s.height))+';'+'"/>';return this.each(function(){if($(this).children('iframe.bgiframe').length===0)this.insertBefore(document.createElement(a),this.firstChild)})}:function(){return''}));!$.fn.ajaxSubmit&&($.fn.ajaxSubmit=function(a){var b,data;if(!this.length)return this;if(typeof a=='function'){a={success:a}}b=$.trim(this.attr('action'));if(b){b=(/^([^#]+)/.exec(b)||{})[1]}b=b||p.location.href||'';a=$.extend({url:b,type:this.attr('method')||'GET'},a||{});if(a.beforeSerialize&&a.beforeSerialize(this,a)===false){return this}data=this.serializeArray();if(a.data){a.extraData=a.data;for(var n in a.data){if(a.data[n]instanceof Array){for(var k in a.data[n])data.push({name:n,value:a.data[n][k]})}else data.push({name:n,value:a.data[n]})}}if(a.beforeSubmit&&a.beforeSubmit(data,this,a)===false){return this}a.data=data;$.ajax(a);this.trigger('formSubmit',[this,a]);return this});function prop(n){return n&&n.constructor===Number?n+'px':n}function isFunction(a,b){if(!a){return false}if(typeof a=='function'){return a}if(typeof a=='string'){a=a.split('.');var o=(b||p)[a[0]],w=null;if(!o)return q;for(var i=1,l;l=a[i++];){if(!o[l]){return q}w=o;o=o[l]}return o&&(function(){return o.apply(w,arguments)})}return null}function floatval(a){return a&&parseFloat((a+'').replace(/[^\d]*/,''))||0}function createIframe(a,b,c){b=floatval(b)+UNIT_PX;c=floatval(c)+UNIT_PX;return $(['<iframe src="',a,'" style="width:',b,'; height:',c,'; border:0; margin:0; padding:0;'].join(''))}function createOverlay(a,b){var c=$(['<div id="',PREFIX,'overlay_',GUID,'" class="',b.overlay,'"></div>'].join(''));c.css({'opacity':OPACITY,'z-index':ZINDEX});return c}function createShadow(a,b){var c=$(['<div id="',PREFIX,'shadow_',GUID,'" class="',b.shadow,'"></div>'].join(''));c.css({'z-index':ZINDEX,'opacity':SHADOW_OPACITY});return c}function createBox(a,b){var c=$(['<div id="',PREFIX,'box_',GUID,'" class="',b.box,a.dialogClass?' '+a.dialogClass:'','">','<div class="',b.title,'"><a href="javascript:void(0);" title="',LANG.CLOSE,'" class="',b.close,'">X</a>',a.title,'</div>','<div class="',b.content,'"><div class="',b.content_inner,'">',a.message&&!a.message.jquery?a.message:'','</div></div>','<div class="',b.footer,'">','<div class="',b.widget,'"></div>','<div class="',b.buttons,'"></div>','</div>','</div>'].join(''));c.css({'z-index':ZINDEX});a.message&&a.message.jquery&&(c.find('.'+b.content_inner).append(a.message));return c}function createButton(a,b){var c=$(['<span class="',b.button,'"><input type="button" value="',a.text,'" /></span>'].join(''));c.hover(function(){$(this).addClass(b.button_hover)},function(){$(this).removeClass(b.button_hover)});c.focus(function(){$(this).addClass(b.button_focus)});c.blur(function(){$(this).removeClass(b.button_focus)});return c}function createTips(a,b){return $(['<div class="',b.tips,'">',a.message,'</div>'].join(''))}p.dialog={_options:CONFIG,_clazz:CLASS,_common:function(a){if(!a){throw'dialog need message or callback';}if(a.jquery||typeof a=='string'){a={'message':a}}return a},_button:function(b,c){var d=this;return{text:b,callback:function(a){if(isFunction(c)&&c()===false){return false}d.close(a,true)}}},setup:function(a,b,c){$.extend(this._options,a||{});$.extend(this._clazz,b||{});$.extend(r,c||{});a.locale&&(LANG=getLocale(a.locale));return this},ok:function(a,b){var c=this;a=this._common(a);if(!a.buttons){a.buttons=[c._button(LANG.OK,b)]}if(!a.dialogClass){a.dialogClass=this._clazz.dialog_ok}return this.dialog(a,q,q,q,b)},error:function(a,b){var c=this;a=this._common(a);if(!a.buttons){a.buttons=[c._button(LANG.OK,b)]}if(!a.dialogClass){a.dialogClass=this._clazz.dialog_error}return this.dialog(a,q,q,q,b)},confirm:function(a,b,c){var d=this;a=this._common(a);if(!a.buttons){a.buttons=[d._button(LANG.OK,b),d._button(LANG.CANCEL,c)]}if(!a.dialogClass){a.dialogClass=this._clazz.dialog_confirm}return this.dialog(a,q,q,q,c)},tips:function(a,b,c){var d=this,guid;if(typeof a=='function'){c=a;a={}}else if(typeof b=='function'){c=b}a=$.extend({},this._options,this._common(a));a.message=createTips(a,this._clazz);guid=this.dialog(a,q,q,q,c);!b&&(b=2500);b!=-1&&(setTimeout(function(){d.close(guid)},b))},form:function(f,g,h,i,j,k,l,m){var n=this,div,guid;if(!f){throw'dialog.form need title';}if(typeof f=='string'){f={'title':f}}if(!f.buttons){f.buttons=[{text:LANG.OK,callback:function(d){var e=n.get(d),form=e.find('form:last'),buttons=e.find('.'+n._clazz.buttons).children(':button'),callback,complete;callback=function(a){if(isFunction(h)&&h(a)===false){return false}n.close(d,true)};complete=function(){buttons.removeAttr('disabled')};if(form.size()){form.ajaxSubmit({dataType:'json',type:'post',success:callback,error:function(a,b,c){if(isFunction(j)){j(a,b,c)}else{n.error(f.errorMessage)}},complete:complete,beforeSubmit:function(){buttons.attr('disabled','disabled');if(isFunction(k)&&k(form,d)===false){complete();return false}return true},beforeSerialize:l});return false}callback(e)}},n._button(LANG.CANCEL,m)]}!f.message&&(f.message=CONFIG.message);div=createTips(f,this._clazz);function callback(){n.resize(guid)}div.load(g,function(){isFunction(i)&&i(guid);callback()}).bind('ajaxComplete',function(){callback()});f.message=div;guid=this.dialog(f,q,q,q,m)},show:function(a,b,c,d,e){},dialog:function(b,c,d,e,f){var g=this,clazz=this._clazz,guid,box,overlay,shadow,buttons,buttons_area;if(!b){throw'dialog.dialog need options.';}if(!isFunction(c)){if(isFunction(b)){c=b;b={}}else if(typeof b=='string'){b={title:b}}}b=$.extend({},this._options,b);guid=++GUID;ZINDEX++;box=createBox(b,clazz);box.data('options',b);if(b.overlay){overlay=createOverlay(b,clazz);box.data('overlay',b.overlay);$(doc.body).append(overlay);b.iframe&&overlay.bgiframe()}if(b.shadow){shadow=createShadow(b,clazz);box.data('shadow',b.shadow);$(doc.body).append(shadow);!b.overlay&&b.iframe&&(shadow.bgiframe())}if(b.buttons||b.widget){buttons=b.buttons;buttons_area=box.find('.'+clazz.buttons);if(buttons&&buttons.length){var h,index,length=buttons.length,option;for(index=0;index<length;index++){(function(a){h=createButton(a,clazz);if(isFunction(a.callback)){h.click(function(){a.callback(guid)})}buttons_area.prepend(h)})(buttons[index])}}}else{box.find('.'+clazz.footer).remove()}$(doc.body).append(box);!b.overlay&&!b.shadow&&b.iframe&&(box.bgiframe());this.resize(guid);$(p).resize(function(){g.resize(guid)});isFunction(e)&&e(box);isFunction(f)&&box.data('close',f);box.find('.'+clazz.close).click(function(){g.close(guid);return false});return guid},get:function(a){return $('#'+PREFIX+'box_'+a)},getOverlay:function(a){return $('#'+PREFIX+'overlay_'+a)},getShadow:function(a){return $('#'+PREFIX+'shadow_'+a)},close:function(a,b){var c=this.get(a),close;if(!c.size()){return false}close=c.data('close');if(!b&&isFunction(close)&&close()===false){return false}if(c.data('overlay')){this.getOverlay(a).remove()}if(c.data('shadow')){this.getShadow(a).remove()}c.remove();return true},resize:function(a){var b=this.get(a),options=b.data('options'),overlay,shadow,content,width,height,awidth,aheight,osize,title_height,footer_height,documentWidth=doe.clientWidth,documentHeight=doe.clientHeight,pageWidth=$(doc).width(),pageHeight=max($(doc).height(),documentHeight);if(!b.size()){return false}if(b.data('overlay')){overlay=this.getOverlay(a);overlay.css({width:pageWidth,height:pageHeight})}content=b.find('.'+CLASS.content);title_height=b.find('.'+CLASS.title).outerHeight(true);footer_height=b.find('.'+CLASS.footer).outerHeight(true);content.css({width:'auto',height:'auto'});b.css({width:'auto',height:'auto'});osize=2*SHADOW_PADDING+2*BOX_BORDER_WIDTH;width=b.width();awidth=documentWidth-osize;width=max(awidth<width?awidth:width,options.minWidth);options.width&&(width=min(width,options.width));b.data('shadow')&&this.getShadow(a).css({width:width+osize,left:'50%','margin-left':Math.floor(width/2)*-1-SHADOW_PADDING});b.css({width:width,left:'50%','margin-left':Math.floor(width/2)*-1});content.css({width:width});height=b.height();aheight=documentHeight-osize;height=max(aheight<height?aheight:height,options.minHeight);options.height&&(height=min(height,options.height));b.data('shadow')&&this.getShadow(a).css({height:height+osize,top:max(0,Math.floor(max(documentHeight-height,0)/2)-SHADOW_PADDING)});b.css({height:height,top:max(SHADOW_PADDING,Math.floor(max(documentHeight-height,0)/2))});content.css({height:height-title_height-footer_height});return true}}})(jQuery,window);
